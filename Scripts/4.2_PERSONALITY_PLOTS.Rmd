---
title: "Personality Plots"
author: "Hamza"
date: "04/11/2020"
output: html_document
---

### Load packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#checks for installation and loads packages
pacman::p_load(lmerTest,ggThemeAssist,rptR,lme4,readxl, tidyr, dplyr, magrittr, lubridate, stringr, purrr,
               sjPlot,ggplot2,lubridate,wesanderson,ggbeeswarm,emmeans,patchwork,viridis,nlme,Rmisc,ggpubr,
               stargazer)
# Load custom functions
source("../Scripts/functions_plots.R") #load custom functions
```

# Importing and Subsetting Data
```{r}
Personality <- read.csv("../Data/Personality/ALL.csv")

# making a column with a factor where the four levels correspond to the four phases
Personality$phase <-  factor(Personality$Time, levels = c("6-9", "13-16", "20-23", "27-30")) 

# making a list where each level of the list is a different phase
phases <- split(Personality, Personality$phase)

# function to apply to the four phases: 1, 2, 3, and 4
func_phase <- function(phase = 1){
    df <- phases[[phase]] # getting phase dataframe based on index (1-4)
    df$Behaviour <- df[,paste0("Phase",phase)] # getting columns that says which behaviour was in that phase
    df <- df[,!(names(df) %in% paste0("Phase", 1:4))] # removing the now-redunant Phase1,...,Phase4 columns
    return(df) # return dataframe
}

# applying function, returning a list of four dataframes
Personality_list <- lapply(1:4, function(x) func_phase(x))
Personality_df <- bind_rows(Personality_list) # stakes dataframe on top of each other

Aggression_ALL <- Personality_df[Personality_df$Behaviour == "Aggression",]
Novel_ALL <- Personality_df[Personality_df$Behaviour == "Novel",]
Predator_ALL <- Personality_df[Personality_df$Behaviour == "Predator",]
Social_ALL <- Personality_df[Personality_df$Behaviour == "Social",]

#Subsetting data by control and treatment
Social_Control <- subset(Social_ALL, Social_ALL$Group == "Control") 
Social_Treatment <- subset(Social_ALL, Social_ALL$Group == "Treatment") 

Predator_Control <- subset(Predator_ALL, Predator_ALL$Group == "Control") 
Predator_Treatment <- subset(Predator_ALL, Predator_ALL$Group == "Treatment") 

Novel_Control <- subset(Novel_ALL, Novel_ALL$Group == "Control") 
Novel_Treatment <- subset(Novel_ALL, Novel_ALL$Group == "Treatment") 

Aggression_Control <- subset(Aggression_ALL, Aggression_ALL$Group == "Control") 
Aggression_Treatment <- subset(Aggression_ALL, Aggression_ALL$Group == "Treatment") 

# EXPLORATION DATA
# Acclimation <- read.csv("../Data/Personality/Acclimation.csv")
Post_assay <- read.csv("../Data/Personality/Post-assay.csv")
```

#Creating tibbles to use in plotting repeatabilities : one for overall plots, and one for sex plots

Social analysis
```{r, echo=FALSE}
Social_rptr_F0 <- tibble(
  Group = c("Control", "Treatment", "Contrast", "Between-Individual Variance (Control Group)", "Within-Individual Variance (Control Group)","Between-Individual Variance (Treatment Group)", "Within-Individual Variance (Treatment Group)"),
  r = c(rpt_social_control$R$Fish_ID,rpt_social_treatment$R$Fish_ID, m_social, within_between_social_control$R[1], within_between_social_control$R[2],within_between_social_treatment$R[1], within_between_social_treatment$R[2]),
  ci.lb = c(rpt_social_control$CI_emp$`2.5%`,rpt_social_treatment$CI_emp$`2.5%`,-0.08, within_between_social_control$CI_emp[1,1], within_between_social_control$CI_emp[2,1],within_between_social_treatment$CI_emp[1,1], within_between_social_treatment$CI_emp[2,1]),
  ci.ub = c(rpt_social_control$CI_emp$`97.5%`,rpt_social_treatment$CI_emp$`97.5%`, 0.30, within_between_social_control$CI_emp[1,2], within_between_social_control$CI_emp[2,2],within_between_social_treatment$CI_emp[1,2], within_between_social_treatment$CI_emp[2,2]),
Endpoint = c("Social", "Social", "Social", "Social", "Social","Social","Social"))
  
Social_rptr_F0$r <- as.numeric(Social_rptr_F0$r)
Social_rptr_F0

Social_rptr_sex <- tibble(
  Tank = c("Control","Control", "Treatment", "Treatment", "Control", "Treatment"),
  Condition = c("Male","Female","Male", "Female", "Contrast", "Contrast"),
  r = c(rpt_social_control_male$R$Fish_ID,rpt_social_control_female$R$Fish_ID,rpt_social_treatment_male$R$Fish_ID,rpt_social_treatment_female$R$Fish_ID,m_social_control, m_social_treatment ),
  ci.lb = c(rpt_social_control_male$CI_emp$`2.5%`,rpt_social_control_female$CI_emp$`2.5%`,rpt_social_treatment_male$CI_emp$`2.5%`,rpt_social_treatment_female$CI_emp$`2.5%`, 0.009, 0.03),
  ci.ub = c(rpt_social_control_male$CI_emp$`97.5%`,rpt_social_control_female$CI_emp$`97.5%`,rpt_social_treatment_male$CI_emp$`97.5%`,rpt_social_treatment_female$CI_emp$`97.5%`, 0.39, 0.49),
Endpoint = c("Social","Social","Social","Social","Social","Social"))
  
Social_rptr_sex
```


Novel analysis
```{r, echo=FALSE}
Novel_rptr_F0 <- tibble(
  Group = c("Control", "Treatment", "Contrast", "Between-Individual Variance (Control Group)", "Within-Individual Variance (Control Group)","Between-Individual Variance (Treatment Group)", "Within-Individual Variance (Treatment Group)"),
  r = c(rpt_novel_control$R$Fish_ID,rpt_novel_treatment$R$Fish_ID, m_novel, within_between_novel_control$R[1], within_between_novel_control$R[2],within_between_novel_treatment$R[1], within_between_novel_treatment$R[2]),
  ci.lb = c(rpt_novel_control$CI_emp$`2.5%`,rpt_novel_treatment$CI_emp$`2.5%`,-0.01, within_between_novel_control$CI_emp[1,1], within_between_novel_control$CI_emp[2,1],within_between_novel_treatment$CI_emp[1,1], within_between_novel_treatment$CI_emp[2,1]),
  ci.ub = c(rpt_novel_control$CI_emp$`97.5%`,rpt_novel_treatment$CI_emp$`97.5%`, 0.26, within_between_novel_control$CI_emp[1,2], within_between_novel_control$CI_emp[2,2],within_between_novel_treatment$CI_emp[1,2], within_between_novel_treatment$CI_emp[2,2]),
Endpoint = c("Novel", "Novel", "Novel", "Novel", "Novel","Novel","Novel"))
  
Novel_rptr_F0$r <- as.numeric(Novel_rptr_F0$r)
Novel_rptr_F0

Novel_rptr_sex <- tibble(
  Tank = c("Control","Control", "Treatment", "Treatment", "Control", "Treatment"),
  Condition = c("Male","Female","Male", "Female", "Contrast", "Contrast"),
  r = c(rpt_novel_control_male$R$Fish_ID,rpt_novel_control_female$R$Fish_ID,rpt_novel_treatment_male$R$Fish_ID,rpt_novel_treatment_female$R$Fish_ID,m_novel_control, m_novel_treatment ),
  ci.lb = c(rpt_novel_control_male$CI_emp$`2.5%`,rpt_novel_control_female$CI_emp$`2.5%`,rpt_novel_treatment_male$CI_emp$`2.5%`,rpt_novel_treatment_female$CI_emp$`2.5%`, -0.06, -0.16),
  ci.ub = c(rpt_novel_control_male$CI_emp$`97.5%`,rpt_novel_control_female$CI_emp$`97.5%`,rpt_novel_treatment_male$CI_emp$`97.5%`,rpt_novel_treatment_female$CI_emp$`97.5%`, 0.40, 0.17),
Endpoint = c("Novel","Novel","Novel","Novel","Novel","Novel"))
  
Novel_rptr_sex
```

Predator analysis
```{r, echo=FALSE}
Predator_rptr_F0 <- tibble(
  Group = c("Control", "Treatment", "Contrast", "Between-Individual Variance (Control Group)", "Within-Individual Variance (Control Group)","Between-Individual Variance (Treatment Group)", "Within-Individual Variance (Treatment Group)"),
  r = c(rpt_predator_control$R$Fish_ID,rpt_predator_treatment$R$Fish_ID, m_predator, within_between_predator_control$R[1], within_between_predator_control$R[2],within_between_predator_treatment$R[1], within_between_predator_treatment$R[2]),
  ci.lb = c(rpt_predator_control$CI_emp$`2.5%`,rpt_predator_treatment$CI_emp$`2.5%`,-0.13, within_between_predator_control$CI_emp[1,1], within_between_predator_control$CI_emp[2,1],within_between_predator_treatment$CI_emp[1,1], within_between_predator_treatment$CI_emp[2,1]),
  ci.ub = c(rpt_predator_control$CI_emp$`97.5%`,rpt_predator_treatment$CI_emp$`97.5%`, 0.27, within_between_predator_control$CI_emp[1,2], within_between_predator_control$CI_emp[2,2],within_between_predator_treatment$CI_emp[1,2], within_between_predator_treatment$CI_emp[2,2]),
Endpoint = c("Predator", "Predator", "Predator", "Predator", "Predator","Predator","Predator"))
  
Predator_rptr_F0$r <- as.numeric(Predator_rptr_F0$r)
Predator_rptr_F0

Predator_rptr_sex <- tibble(
  Tank = c("Control","Control", "Treatment", "Treatment", "Control", "Treatment"),
  Condition = c("Male","Female","Male", "Female", "Contrast", "Contrast"),
  r = c(rpt_predator_control_male$R$Fish_ID,rpt_predator_control_female$R$Fish_ID,rpt_predator_treatment_male$R$Fish_ID,rpt_predator_treatment_female$R$Fish_ID,m_predator_control, m_predator_treatment ),
  ci.lb = c(rpt_predator_control_male$CI_emp$`2.5%`,rpt_predator_control_female$CI_emp$`2.5%`,rpt_predator_treatment_male$CI_emp$`2.5%`,rpt_predator_treatment_female$CI_emp$`2.5%`, -0.10, -0.15),
  ci.ub = c(rpt_predator_control_male$CI_emp$`97.5%`,rpt_predator_control_female$CI_emp$`97.5%`,rpt_predator_treatment_male$CI_emp$`97.5%`,rpt_predator_treatment_female$CI_emp$`97.5%`, 0.41, 0.39),
Endpoint = c("Predator","Predator","Predator","Predator","Predator","Predator"))
  
Predator_rptr_sex
```

Aggression analysis
```{r, echo=FALSE}
Aggression_rptr_F0 <- tibble(
  Group = c("Control", "Treatment", "Contrast", "Between-Individual Variance (Control Group)", "Within-Individual Variance (Control Group)","Between-Individual Variance (Treatment Group)", "Within-Individual Variance (Treatment Group)"),
  r = c(rpt_aggression_control$R$Fish_ID,rpt_aggression_treatment$R$Fish_ID, m_aggression, within_between_aggression_control$R[1], within_between_aggression_control$R[2],within_between_aggression_treatment$R[1], within_between_aggression_treatment$R[2]),
  ci.lb = c(rpt_aggression_control$CI_emp$`2.5%`,rpt_aggression_treatment$CI_emp$`2.5%`,0.01, within_between_aggression_control$CI_emp[1,1], within_between_aggression_control$CI_emp[2,1],within_between_aggression_treatment$CI_emp[1,1], within_between_aggression_treatment$CI_emp[2,1]),
  ci.ub = c(rpt_aggression_control$CI_emp$`97.5%`,rpt_aggression_treatment$CI_emp$`97.5%`, 0.26, within_between_aggression_control$CI_emp[1,2], within_between_aggression_control$CI_emp[2,2],within_between_aggression_treatment$CI_emp[1,2], within_between_aggression_treatment$CI_emp[2,2]),
Endpoint = c("Aggression", "Aggression", "Aggression", "Aggression", "Aggression","Aggression","Aggression"))
  
Aggression_rptr_F0$r <- as.numeric(Aggression_rptr_F0$r)
Aggression_rptr_F0

Aggression_rptr_sex <- tibble(
  Tank = c("Control","Control", "Treatment", "Treatment", "Control", "Treatment"),
  Condition = c("Male","Female","Male", "Female", "Contrast", "Contrast"),
  r = c(rpt_aggression_control_male$R$Fish_ID,rpt_aggression_control_female$R$Fish_ID,rpt_aggression_treatment_male$R$Fish_ID,rpt_aggression_treatment_female$R$Fish_ID,m_aggression_control, m_aggression_treatment ),
  ci.lb = c(rpt_aggression_control_male$CI_emp$`2.5%`,rpt_aggression_control_female$CI_emp$`2.5%`,rpt_aggression_treatment_male$CI_emp$`2.5%`,rpt_aggression_treatment_female$CI_emp$`2.5%`, 0.12, -0.18),
  ci.ub = c(rpt_aggression_control_male$CI_emp$`97.5%`,rpt_aggression_control_female$CI_emp$`97.5%`,rpt_aggression_treatment_male$CI_emp$`97.5%`,rpt_aggression_treatment_female$CI_emp$`97.5%`, 0.54, 0.24),
Endpoint = c("Aggression","Aggression","Aggression","Aggression","Aggression","Aggression"))
  
Aggression_rptr_sex
```

Activity analysis
```{r}
Activity_rptr_F0 <- tibble(
  Group = c("Control", "Treatment", "Contrast", "Between-Individual Variance (Control Group)", "Within-Individual Variance (Control Group)","Between-Individual Variance (Treatment Group)", "Within-Individual Variance (Treatment Group)"),
  r = c(rpt_post_assay_control$R$Fish_ID,rpt_post_assay_treatment$R$Fish_ID, m_post_assay, within_between_activity_control$R[1], within_between_activity_control$R[2],within_between_activity_treatment$R[1], within_between_activity_treatment$R[2]),
  ci.lb = c(rpt_post_assay_control$CI_emp$`2.5%`,rpt_post_assay_treatment$CI_emp$`2.5%`,-0.16, within_between_activity_control$CI_emp[1,1], within_between_activity_control$CI_emp[2,1],within_between_activity_treatment$CI_emp[1,1], within_between_activity_treatment$CI_emp[2,1]),
  ci.ub = c(rpt_post_assay_control$CI_emp$`97.5%`,rpt_post_assay_treatment$CI_emp$`97.5%`, 0.24, within_between_activity_control$CI_emp[1,2], within_between_activity_control$CI_emp[2,2],within_between_activity_treatment$CI_emp[1,2], within_between_activity_treatment$CI_emp[2,2]),
Endpoint = c("Activity", "Activity", "Activity", "Activity", "Activity","Activity","Activity"))
  
Activity_rptr_F0$r <- as.numeric(Activity_rptr_F0$r)
Activity_rptr_F0

Activity_rptr_sex <- tibble(
  Tank = c("Control","Control", "Treatment", "Treatment", "Control", "Treatment"),
  Condition = c("Male","Female","Male", "Female", "Contrast", "Contrast"),
  r = c(rpt_post_assay_control_male$R$Fish_ID,rpt_post_assay_control_female$R$Fish_ID,rpt_post_assay_treatment_male$R$Fish_ID,rpt_post_assay_treatment_female$R$Fish_ID,m_post_assay_control, m_post_assay_treatment ),
  ci.lb = c(rpt_post_assay_control_male$CI_emp$`2.5%`,rpt_post_assay_control_female$CI_emp$`2.5%`,rpt_post_assay_treatment_male$CI_emp$`2.5%`,rpt_post_assay_treatment_female$CI_emp$`2.5%`, -0.17, -0.22),
  ci.ub = c(rpt_post_assay_control_male$CI_emp$`97.5%`,rpt_post_assay_control_female$CI_emp$`97.5%`,rpt_post_assay_treatment_male$CI_emp$`97.5%`,rpt_post_assay_treatment_female$CI_emp$`97.5%`, 0.40, 0.36),
Endpoint = c("Activity","Activity","Activity","Activity","Activity","Activity"))
  
Activity_rptr_sex
```


Joining tibbles to use in plotting 
```{r}

#Joining all tibbles for overall
Personality_Joined1 <- full_join(Social_rptr_F0, Novel_rptr_F0)
Personality_Joined2 <- full_join(Personality_Joined1, Aggression_rptr_F0)
Personality_Joined3 <- full_join(Personality_Joined2,Activity_rptr_F0 )
Personality_Joined_Final <- full_join(Personality_Joined3, Predator_rptr_F0)





Overall_Personality_Plotting_Data_F0 <- subset(Personality_Joined_Final, Personality_Joined_Final$Group %in% c("Treatment","Control","Contrast")) #Will be used for plotting just the overall repeatabilites 



#Joining all tibbles for sex
Overall_Personality_Sex1 <- full_join(Social_rptr_sex, Aggression_rptr_sex)
Overall_Personality_Sex2 <- full_join(Overall_Personality_Sex1, Predator_rptr_sex)
Overall_Personality_Sex3 <- full_join(Overall_Personality_Sex2, Activity_rptr_sex)
Overall_Personality_Sex_Final <- full_join(Overall_Personality_Sex3, Novel_rptr_sex)


```
#Overall forest plot showing repeatabilities of control and treatment groups (Personality F0)
```{r}

Overall_plot_F0_personality <- ggplot(Overall_Personality_Plotting_Data_F0, aes(x=Endpoint, y=r, colour=Group)) +
geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0.4, position = position_dodge(0.3), size=0.8) +
geom_point(aes(x = Endpoint, y = r), position = position_dodge(0.3), size=3)+
geom_hline(yintercept = 0, lty = "dotted") +
coord_flip()+
ylim(-0.25, 0.9)+
   theme(axis.title.y=element_blank())+
  theme_classic()+
  scale_color_manual(values=c("#000000", "#DD8D29", "#E2D200"))+
    theme(panel.border = element_rect(colour = "black", fill=NA, size=2),axis.ticks = element_line(size=2,color="black"),axis.ticks.length=unit(0.2,"cm"))+      font("xylab",size=15)+font("xy",size=15)+font("xy.text", size = 15) +
  theme(axis.title.y=element_blank())+
   theme(legend.position = "bottom")+
    theme(legend.title=element_blank())
 


Overall_plot_F0_personality
```



#Overall forest plot showing differences between males and female repeatabilities for personality
```{r}
Sex_New_plot_personality <-
  ggplot(Overall_Personality_Sex_Final,
         aes(x = Endpoint, y = r, colour = Condition)) +
  geom_errorbar(
    aes(ymin = ci.lb, ymax = ci.ub),
    width = 0.4,
    position = position_dodge(0.3),
    size = 0.8
  ) +
  geom_point(aes(x = Endpoint, y = r),
             position = position_dodge(0.3),
             size = 3) +
  geom_hline(yintercept = 0, lty = "dotted") +
  coord_flip() +
  ylim(-0.4, 0.9) +
  facet_grid( ~ Tank) +
  theme(axis.title.y = element_blank()) +
  scale_color_manual(values = c("#000000", "#f8766d", "#00bfc4")) +
    theme_classic()+
  theme(
    panel.border = element_rect(
      colour = "black",
      fill = NA,
      size = 2
    ),
    axis.ticks = element_line(size = 2, color = "black"),
    axis.ticks.length = unit(0.2, "cm")
  ) +      font("xylab", size = 15) + font("xy", size = 15) + font("xy.text", size = 15) +
  theme(axis.title.y = element_blank()) +
  theme(legend.position = "bottom") +
  theme(legend.title = element_blank())

Sex_New_plot_personality

```


#Generating custom designed violin plots to display raw distributions of behavioral responses
```{r}


social_violin <- violin_plot_custom_hamza2(Social_ALL,Social_ALL$zone_05_dur,"Time spent near social stimulus", "Seconds")%>% +facet_grid(~Sex)+
stat_summary(fun=mean, geom="point", shape=18, size=3, color="red", fill="red")

social_violin





aggression_violin <- violin_plot_custom_hamza2(Aggression_ALL, Aggression_ALL$zone_05_dur, "Time spent near aggressive stimulus", "Seconds")%>% +facet_grid(~Sex)+
stat_summary(fun=mean, geom="point", shape=18, size=3, color="red", fill="red")



novel_violin <- violin_plot_custom_hamza2(Novel_ALL, Novel_ALL$zone_05_dur, "Time spent near novel stimulus", "Seconds")%>% +facet_grid(~Sex)+
stat_summary(fun=mean, geom="point", shape=18, size=3, color="red", fill="red")

predator_violin <- violin_plot_custom_hamza2(Predator_ALL, Predator_ALL$zone_05_dur, "Time spent near predatory stimulus", "Seconds")%>% +facet_grid(~Sex)+
stat_summary(fun=mean, geom="point", shape=18, size=3, color="red", fill="red")

activity_violin <- violin_plot_custom_hamza2(Post_assay, Post_assay$tot_dist_Activity, "Total distance travelled post-assay", "Seconds")%>% +facet_grid(~Sex)+
stat_summary(fun=mean, geom="point", shape=18, size=3, color="red", fill="red")

activity_violin




#Joining plots together using patchwork to create one main plot

Joined_violins_personality <- social_violin + aggression_violin + novel_violin + predator_violin + activity_violin +
  plot_layout(ncol = 2, nrow=3)
Joined_violins_personality
```

#individual means and plotting them only
```{r}
#Activity

individual_means_activity <- Post_assay %>%
    group_by(Fish_ID, Group, Sex) %>%
    dplyr::summarize(Mean = mean(tot_dist_Activity, na.rm=TRUE))

individual_means_activity

indiv_activity <-ggplot(individual_means_activity, aes(Group, Mean, fill=Group)) + 
   geom_violin(alpha = 0.1, draw_quantiles = c(0.25, 0.5, 0.75)) + 
  geom_jitter(width = 0.2, height = 0, alpha = 0.2) +
    theme_classic()+
  theme(axis.ticks.x=element_blank(),
       axis.title.x=element_blank())+
  labs(y="Mean distance travelled (cm)")+
   labs(title = "Activity")+
  theme(legend.position="none")+
  facet_grid(~Sex)

indiv_activity

#Social
individual_means_social <- Social_ALL %>%
    group_by(Fish_ID, Group, Sex) %>%
    dplyr::summarize(Mean = mean(zone_05_dur, na.rm=TRUE))

individual_means_social

indiv_social <-ggplot(individual_means_social, aes(Group, Mean, fill=Group)) + 
   geom_violin(alpha = 0.1, draw_quantiles = c(0.25, 0.5, 0.75)) + 
  geom_jitter(width = 0.2, height = 0, alpha = 0.2) +
    theme_classic()+
  theme(axis.ticks.x=element_blank(),
       axis.title.x=element_blank())+
  labs(y="Mean time spent near screen")+
   labs(title = "Social")+
  theme(legend.position="none")+
  facet_grid(~Sex)

indiv_social

#Aggression
individual_means_aggression <- Aggression_ALL %>%
    group_by(Fish_ID, Group, Sex) %>%
    dplyr::summarize(Mean = mean(zone_05_dur, na.rm=TRUE))

individual_means_aggression

indiv_aggression <-ggplot(individual_means_aggression, aes(Group, Mean, fill=Group)) + 
   geom_violin(alpha = 0.1, draw_quantiles = c(0.25, 0.5, 0.75)) + 
  geom_jitter(width = 0.2, height = 0, alpha = 0.2) +
    theme_classic()+
  theme(axis.ticks.x=element_blank(),
       axis.title.x=element_blank())+
  labs(y="Mean time spent near screen")+
   labs(title = "Aggression")+
  theme(legend.position="none")+
  facet_grid(~Sex)

indiv_aggression

#Novel
individual_means_novel <- Novel_ALL %>%
    group_by(Fish_ID, Group, Sex) %>%
    dplyr::summarize(Mean = mean(zone_05_dur, na.rm=TRUE))

individual_means_novel

indiv_novel <-ggplot(individual_means_novel, aes(Group, Mean, fill=Group)) + 
   geom_violin(alpha = 0.1, draw_quantiles = c(0.25, 0.5, 0.75)) + 
  geom_jitter(width = 0.2, height = 0, alpha = 0.2) +
    theme_classic()+
  theme(axis.ticks.x=element_blank(),
       axis.title.x=element_blank())+
  labs(y="Mean time spent near screen")+
   labs(title = "Novel")+
  theme(legend.position="none")+
  facet_grid(~Sex)

indiv_novel

#Predator
individual_means_predator <- Predator_ALL %>%
    group_by(Fish_ID, Group, Sex) %>%
    dplyr::summarize(Mean = mean(zone_05_dur, na.rm=TRUE))

individual_means_predator

indiv_predator <-ggplot(individual_means_predator, aes(Group, Mean, fill=Group)) + 
   geom_violin(alpha = 0.1, draw_quantiles = c(0.25, 0.5, 0.75)) + 
  geom_jitter(width = 0.2, height = 0, alpha = 0.2) +
    theme_classic()+
  theme(axis.ticks.x=element_blank(),
       axis.title.x=element_blank())+
  labs(y="Mean time spent near screen")+
   labs(title = "Predator")+
  theme(legend.position="none")+
  facet_grid(~Sex)

indiv_predator

#Joining

Joined_violins_indiv <- indiv_activity + indiv_social + indiv_aggression + indiv_novel + indiv_predator + plot_layout(ncol = 2, nrow=4)

Joined_violins_indiv

```

#Creating data frame for within individual and between individual variances

```{r}
Personality_Joined_Final_within_between <- subset(Personality_Joined_Final, Personality_Joined_Final$Group %in% c("Within-Individual Variance (Control Group)","Within-Individual Variance (Treatment Group)", "Between-Individual Variance (Control Group)", "Between-Individual Variance (Treatment Group)")) #Will be used for plotting within-and between individual variance


#Creating a new column
Personality_Joined_Final_within_between$Tank <- c("Control", "Control", "Treatment", "Treatment","Control", "Control", "Treatment", "Treatment","Control", "Control", "Treatment", "Treatment","Control", "Control", "Treatment", "Treatment","Control", "Control", "Treatment", "Treatment")


#Renaming to plot within and between individual variances
Personality_Joined_Final_within_between$Condition <- c("Between-Individual Variance", "Within-Individual Variance", "Between-Individual Variance","Within-Individual Variance","Between-Individual Variance", "Within-Individual Variance", "Between-Individual Variance","Within-Individual Variance","Between-Individual Variance", "Within-Individual Variance", "Between-Individual Variance","Within-Individual Variance","Between-Individual Variance", "Within-Individual Variance", "Between-Individual Variance","Within-Individual Variance","Between-Individual Variance", "Within-Individual Variance", "Between-Individual Variance","Within-Individual Variance")
```

#Plot for within and between individual variance
```{r}
Overall_New_plot_within_between_personality <- ggplot(Personality_Joined_Final_within_between, aes(x=Endpoint, y=r, colour=Tank)) +
geom_errorbar(aes(ymin=ci.lb, ymax=ci.ub), width = 0.4, position = position_dodge(0.3), size=0.8) +
geom_point(aes(x = Endpoint, y = r), position = position_dodge(0.3), size=3)+
geom_hline(yintercept = 0, lty = "dotted") +
coord_flip()+
ylim(0, 1.3)+
   theme(axis.title.y=element_blank())+
   theme(legend.title=element_blank())+
  theme_classic()+
    scale_color_manual(values=c("#DD8D29", "#E2D200"))+
    theme(panel.border = element_rect(colour = "black", fill=NA, size=2),axis.ticks = element_line(size=2,color="black"),axis.ticks.length=unit(0.2,"cm"))+      font("xylab",size=15)+font("xy",size=15)+font("xy.text", size = 15) +
    theme(legend.position = "bottom")+
  theme(axis.title.y=element_blank())+
  facet_grid(~Condition)+
  labs(y = "Variance component")
 
Overall_New_plot_within_between_personality
```



